@model SCM.Models.ViewModels.ExtranetVpnTenantCommunityInViewModel

@{
    ViewData["Title"] = "Add Tenant Community";
}

<ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/Home">Home</a></li>
    <li class="breadcrumb-item"><a href="/Vpn/GetAll">VPNs</a></li>
    <li class="breadcrumb-item"><a href="/ExtranetVpnMember/GetAllByMemberVpnID/@ViewBag.ExtranetVpnMember.MemberVpn.VpnID">Extranet VPN Memberships - [@ViewBag.ExtranetVpnMember.MemberVpn.Name]</a></li>
    <li class="breadcrumb-item"><a href="/ExtranetVpnTenantCommunityIn/GetAllByExtranetVpnMemberID/@ViewBag.ExtranetVpnMember.ExtranetVpnMemberID">Extranet VPN Tenant Communities - [@ViewBag.ExtranetVpnMember.ExtranetVpn.Name]</a></li>
    <li class="breadcrumb-item active">Add Tenant Community</li>
</ol>

<h2>Add Community to Extranet VPN '@ViewBag.ExtranetVpnMember.ExtranetVpn.Name'</h2>

<form asp-action="Create">
    <div class="form-horizontal">
        <hr />
        @{await Html.RenderPartialAsync("_ValidationModelErrorPartial");}
        <input type="hidden" asp-for="ExtranetVpnMemberID" value="@ViewBag.ExtranetVpnMember.ExtranetVpnMemberID" />
        <input type="hidden" id="MemberVpnID" value="@ViewBag.ExtranetVpnMember.MemberVpnID" />
        <div class="form-group">
            <label asp-for="Tenant" class="col-md-2 control-label"></label>
            <div class="col-md-10">
                <select asp-for="TenantID" class="form-control" asp-items="ViewBag.TenantID" 
                        data-toggle="tooltip" data-placement="right" title="Select a Tenant. The only Tenants listed are 
                        those which have an Attachment Set configured for the member VPN.">
                    <option value="">-- Select Tenant --</option>
                </select>
                <span asp-validation-for="TenantID" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label asp-for="VpnTenantCommunityIn" class="col-md-2 control-label"></label>
            <div class="col-md-10">
                <select asp-for="VpnTenantCommunityInID" class="form-control" asp-items="ViewBag.VpnTenantCommunityInID" 
                        data-toggle="tooltip" data-placement="right" title="Select a Tenant Community. The only Tenant Communities listed are 
                        those which are configured for import into the member VPN AND which are enabled for Extranet. 
                        The selected community will also be imported into the
                        Extranet VPN.">
                    <option value="">-- Select Tenant Community --</option>
                </select>
                <span asp-validation-for="VpnTenantCommunityInID" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <button type="submit" id="Add" class="btn btn-success" asp-action="Create">
                    <span class="glyphicon glyphicon-plus"></span>&nbsp;Add
                </button>
            </div>
        </div>
    </div>
</form>

<div>
    <a asp-action="GetAllByExtranetVpnMemberID" asp-route-id="@ViewBag.ExtranetVpnMember.ExtranetVpnMemberID">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script type="text/javascript">

        (function ($) {

            // Initialise all tool-tips

            $('[data-toggle="tooltip"]').tooltip();

            var $tenant = $('#TenantID'),
                tenant = $tenant[0],
                $vpnTenantCommunity = $('#VpnTenantCommunityInID'),
                vpnTenantCommunity = $vpnTenantCommunity[0],
                $memberVpn = $('#MemberVpnID'),
                memberVpn = $memberVpn[0];

            if (vpnTenantCommunity.value == null || vpnTenantCommunity.value == "") {

                vpnTenantCommunity.disabled = true;
            }

            $tenant.on('change', function (e) {

                vpnTenantCommunity.selectedIndex = 0;
                vpnTenantCommunity.disabled = true;
                PopulateVpnTenantCommunitiesDropDownList(this.value);
            });

            function PopulateVpnTenantCommunitiesDropDownList(tenantID) {

                if (tenantID != null && tenantID.length > 0) {

                    PopulateHtmlFromUrl($vpnTenantCommunity, "/ExtranetVpnTenantCommunityIn/VpnTenantCommunities", {vpnID: memberVpn.value, tenantID: tenantID });
                }
            }

            function PopulateHtmlFromUrl($e, url, data) {

                $.get(url, data)
                    .done(function (data) {

                        // Enable the html element to be populated
                        $e[0].disabled = false;

                        $e.html(data);
                    });
            }

        }(jQuery));

    </script>
}
