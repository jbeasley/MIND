var SCM={};SCM.Utilities=function(){"use strict";function i(n){if(t){var i=Array.prototype.slice.call(arguments);n.invoke.apply(n,i.slice(1)).then(n=>{console.log("invocation completed successfully: "+(n===null?"(null)":n)),n}).catch(n=>{console.log(n)})}}var t=!1,n,r=function(r){function ot(){s.html().length>0&&l.fadeIn();h.html().length>0&&a.fadeIn();c.html().length>0&&v.fadeIn()}function y(n){n.$button.on("click",function(){typeof n.beforeSend=="function"&&n.beforeSend();$.ajax({url:n.url,method:"POST",success:function(t){typeof n.onSuccess=="function"&&n.onSuccess.call(this,t)},error:function(t,i,r){var u,f,e;typeof n.onError=="function"&&(u=[r],t.responseJSON&&(f=t.responseJSON,u=u.concat(f.message),f.errors&&(e=f.errors.map(function(n){return n.message}),u=u.concat(e))),n.onError.call(this,u))}})})}function u(n){var t="<ul>";return typeof n=="object"?n.forEach(function(n){t+="<li>"+n+"<\/li>"}):t+="<li>"+n+"<\/li>",t+="<\/ul>"}function p(n){n.each(function(){var n=$(this),t,i;n.empty();t={lines:13,length:28,width:14,radius:42,scale:.15};i=new Spinner(t).spin(this);n.data("spinner",i)})}function e(n){s.html(n);l.fadeIn();d();nt()}function w(n){h.html(n);a.fadeIn();g();nt()}function o(n){c.html(n);v.fadeIn();d();g()}function d(){h.empty();a.fadeOut();it.fadeOut()}function g(){s.empty();l.fadeOut();tt.fadeOut()}function nt(){c.empty();v.fadeOut();rt.fadeOut()}var s=$("#successMessage"),h=$("#errorMessage"),c=$("#warningMessage"),l=$("#successMessageContainer"),a=$("#errorMessageContainer"),v=$("#warningMessageContainer"),tt=$("#networkSuccessMessageContainer"),it=$("#networkErrorMessageContainer"),rt=$("#networkWarningMessageContainer"),ut='<div class="alert alert-danger" role="alert"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"><\/span><span class="sr-only">Error:<\/span><\/div>',b='<div class="alert alert-success" role="alert"><span class="glyphicon glyphicon-ok-sign" aria-hidden="true"><\/span><span class="sr-only">Success:<\/span><\/div>',k='<div class="alert alert-warning" role="alert"><span class="glyphicon glyphicon-warning-sign" aria-hidden="true"><\/span><span class="sr-only">Warning:<\/span><\/div>',f;let ft=signalR.TransportType.WebSockets,et=new signalR.HttpConnection(`http://${document.location.host}/networkSyncHub`,{transport:ft});n=new signalR.HubConnection(et);n.on("onSingleComplete",(n,t,i)=>{var f=$("#syncStatus_"+n[r.itemKey]);f.data("spinner").stop();$("#requiresSync_"+n[r.itemKey]+" > input").prop("checked",!t);f.parents("tr").find(".btn").prop("disabled",!1);t?(f.html(b),i&&e(u(i))):(f.html(k),i&&o(u(i)))});n.onClosed=n=>{n||console.log("Connection is closed")};n.start().then(()=>{t=!0,i(n,"JoinGroup",r.groupName)}).catch(()=>{});f=$(".row-spinner");r.syncAllUrl&&y({$button:$("#Sync"),$spinnerContainer:f,url:r.syncAllUrl,beforeSend:function(){p(f);$(".btn").prop("disabled",!0)},onSuccess:function(n){f.each(function(){$(this).data("spinner").stop()});$(".btn").prop("disabled",!1);n.success?e(u(n.message)):o(u(n.message))},onError:function(n){$(".btn").prop("disabled",!1);f.each(function(){$(this).data("spinner").stop()});w(u(n))}});r.checkSyncAllUrl&&y({$button:$("#CheckSync"),$spinnerContainer:f,url:r.checkSyncAllUrl,beforeSend:function(){p(f);$(".btn").prop("disabled",!0)},onSuccess:function(n){$(".btn").prop("disabled",!1);f.each(function(){$(this).data("spinner").stop()});n.success?e(u(n.message)):o(u(n.message))},onError:function(n){$(".btn").prop("disabled",!1);f.each(function(){$(this).data("spinner").stop()});w(u(n))}});$(".table .btn-sync, .table .btn-checksync").each(function(){var t=$(this),i=t.parents("td").children(".btn"),h=t.data("item"),n=t.parents("tr").children(".row-spinner"),c=t.parents("tr").children(".checkbox-insync").children("input"),f=t.hasClass("btn-sync")?r.syncUrl:r.checkSyncUrl,s,l;for(s in h)l="{"+s+"}",f=f.replace(l,function(){return h[s]});y({$button:t,$spinnerContainer:n,url:f,beforeSend:function(){p(n);i.prop("disabled",!0)},onSuccess:function(t){n.data("spinner").stop();i.prop("disabled",!1);c.prop("checked",!t.success);t.success?(e(u(t.message)),n.html(b)):(o(u(t.message)),c.prop("checked",!0),n.html(k))},onError:function(t){n.data("spinner").stop();i.prop("disabled",!1);w(u(t));n.html(ut)}})});ot()};return{connectToNetworkSyncHub:r}}(jQuery);